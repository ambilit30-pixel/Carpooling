{% extends 'rides/base.html' %}
{% block title %}Create Ride{% endblock %}

{% block content %}
<style>
    /* Create Ride â€” scoped styles */
    .create-wrap {
        max-width: 820px;
        margin: 18px auto;
        padding: 18px;
    }

    .card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 10px 28px rgba(4, 88, 150, 0.06);
    }

    h2.page-title {
        margin: 0 0 8px 0;
        font-size: 20px;
        color: var(--text);
    }

    .lead {
        color: var(--muted);
        margin-bottom: 12px;
    }

    .grid {
        display: grid;
        gap: 12px;
        grid-template-columns: 1fr 1fr;
    }

    @media (max-width:720px) {
        .grid {
            grid-template-columns: 1fr;
        }
    }

    .field {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    label.field-label {
        font-weight: 700;
        font-size: 14px;
        color: var(--text);
    }

    /* style default form widgets */
    input[type="text"],
    input[type="datetime-local"],
    input[type="number"],
    textarea,
    select {
        width: 100%;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid #e8f3fb;
        background: linear-gradient(180deg, #fff, #fbfeff);
        font-size: 14px;
        color: var(--text);
        outline: none;
    }

    textarea {
        min-height: 88px;
        resize: vertical;
    }

    input:focus,
    textarea:focus,
    select:focus {
        box-shadow: 0 8px 24px rgba(3, 102, 153, 0.08);
        border-color: var(--accent-2);
    }

    .helper {
        font-size: 13px;
        color: var(--muted);
    }

    .inline {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
    }

    .actions {
        margin-top: 14px;
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .btn {
        background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
        color: #fff;
        padding: 10px 14px;
        border-radius: 10px;
        border: 0;
        font-weight: 700;
        cursor: pointer;
        text-decoration: none;
    }

    .btn.ghost {
        background: transparent;
        border: 1px solid rgba(0, 122, 204, 0.12);
        color: var(--accent-2);
        padding: 9px 12px;
        border-radius: 10px;
    }

    .note {
        margin-top: 8px;
        font-size: 13px;
        color: var(--muted);
    }

    .error {
        color: #b45309;
        font-weight: 700;
        font-size: 13px;
        margin-top: 6px;
    }

    .checkbox {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 8px;
    }
</style>

<div class="create-wrap">
    <div class="card" role="region" aria-labelledby="createRideTitle">
        <h2 id="createRideTitle" class="page-title">Create Ride</h2>
        <div class="lead">Create a ride and optionally allow others to join.</div>

        <form method="post" novalidate id="createRideForm">
            {% csrf_token %}
            {{ form.non_field_errors }}

            <div class="grid" style="margin-top:6px">
                <div class="field">
                    <label class="field-label" for="{{ form.source.id_for_label }}">Source</label>
                    {{ form.source }}
                    {% if form.source.errors %}<div class="error">{{ form.source.errors }}</div>{% endif %}
                </div>

                <div class="field">
                    <label class="field-label" for="{{ form.destination.id_for_label }}">Destination</label>
                    {{ form.destination }}
                    {% if form.destination.errors %}<div class="error">{{ form.destination.errors }}</div>{% endif %}
                </div>
            </div>

            <div class="field" style="margin-top:12px">
                <label class="field-label" for="{{ form.arrivaldate.id_for_label }}">Arrival (local)</label>
                {{ form.arrivaldate }}
                {% if form.arrivaldate.errors %}<div class="error">{{ form.arrivaldate.errors }}</div>{% endif %}
                <div class="helper">Use local date & time (server will convert as needed). If your widget is plain text,
                    consider using datetime-local in the form widget.</div>
            </div>

            <div class="grid" style="margin-top:12px">
                <div class="field">
                    <label class="field-label" for="{{ form.passenger.id_for_label }}">Seats reserved by you</label>
                    {{ form.passenger }}
                    {% if form.passenger.errors %}<div class="error">{{ form.passenger.errors }}</div>{% endif %}
                    <div class="helper">Seats you will occupy (includes yourself).</div>
                </div>

                <div class="field">
                    <label class="field-label" for="{{ form.sharable.id_for_label }}">Sharable</label>
                    {{ form.sharable }}
                    {% if form.sharable.errors %}<div class="error">{{ form.sharable.errors }}</div>{% endif %}
                    <div class="helper">Allow other users to join this ride.</div>
                </div>
            </div>

            <div class="field" style="margin-top:12px">
                <label class="field-label" for="{{ form.special.id_for_label }}">Special info (optional)</label>
                {{ form.special }}
                {% if form.special.errors %}<div class="error">{{ form.special.errors }}</div>{% endif %}
                <div class="helper">Examples: "Leaves from main gate", "No heavy luggage", "I prefer non-smoking".</div>
            </div>

            <div class="checkbox">
                <input id="drive_self" type="checkbox" name="drive_self" />
                <label for="drive_self" class="helper">I will drive myself</label>
            </div>

            <div class="note">By creating a ride you agree to coordinate pickup/dropoff with sharers. Consider messaging
                assigned driver after assignment.</div>

            <div class="actions">
                <button class="btn" type="submit" id="createBtn">Create Ride</button>
                <a class="btn ghost" href="{% url 'rides:dashboard' %}">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
    (function () {
        const form = document.getElementById('createRideForm');
        const arrival = form.querySelector('[name="{{ form.arrivaldate.name }}"]');
        const passenger = form.querySelector('[name="{{ form.passenger.name }}"]');
        const createBtn = document.getElementById('createBtn');

        // If form widgets are plain text, try to set arrival input to datetime-local for better UX.
        try {
            if (arrival && arrival.tagName.toLowerCase() === 'input' && arrival.type !== 'datetime-local') {
                arrival.type = 'datetime-local';
            }
        } catch (e) { }

        function showError(el, msg) {
            let existing = el.parentElement.querySelector('.error.client');
            if (!existing) {
                existing = document.createElement('div');
                existing.className = 'error client';
                el.parentElement.appendChild(existing);
            }
            existing.textContent = msg;
        }

        function clearClientErrors() {
            form.querySelectorAll('.error.client').forEach(e => e.remove());
        }

        form.addEventListener('submit', function (e) {
            clearClientErrors();
            let ok = true;

            // validate arrival exists
            if (arrival && !arrival.value) {
                showError(arrival, 'Arrival date & time is required');
                ok = false;
            }

            // validate passenger >= 1
            if (passenger) {
                const val = Number(passenger.value);
                if (!val || isNaN(val) || val < 1) {
                    showError(passenger, 'Please enter at least 1 passenger (yourself)');
                    ok = false;
                }
            }

            if (!ok) {
                e.preventDefault();
                // focus first invalid
                const first = form.querySelector('.error.client');
                if (first) {
                    const control = first.previousElementSibling;
                    control && control.focus && control.focus();
                }
                return false;
            }
            // allow submit
        });
    })();
</script>
{% endblock %}